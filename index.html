<html>
  <head>
    <title>Html-Qrcode Demo</title>
    <body>
      <div id="qr-reader" style="width: 500px"></div>
      <div style="font-weight: 800" id="qr-reader-results">
        Barcode is shown here
      </div>

      <button onclick="onOff()">Scan On/Off</button>
      <!-- <div id="qr-reader-results"></div> -->
    </body>
    <script src="https://unpkg.com/html5-qrcode"></script>

    <script>
      var html5QrcodeScanner = new Html5Qrcode("qr-reader");
      var resultContainer = document.getElementById("qr-reader-results");
      var rdr = document.getElementById("qr-reader");
      let run = true;
      let cameraId;

      function onScanSuccess(decodedText, decodedResult) {
        if (decodedText !== lastResult) {
          ++countResults;
          lastResult = decodedText;
          // Handle on success condition with the decoded message.
          console.log(`Scan result ${decodedText}`, decodedResult);
          resultContainer.innerText = decodedText;
        }
      }

      function docReady(fn) {
        // see if DOM is already available
        if (
          document.readyState === "complete" ||
          document.readyState === "interactive"
        ) {
          // call on next available tick
          setTimeout(fn, 1);
        } else {
          document.addEventListener("DOMContentLoaded", fn);
        }
      }

      function onOff(e) {
        if (!run) {
          let config = {
            fps: 10,
            qrbox: 250,
          };
          html5QrcodeScanner
            .start(cameraId, config, onScanSuccess, () =>
              console.log("Error occured in scanning")
            )
            .catch((e) => console.log("Promise error"));
          run = true;
        } else {
          html5QrcodeScanner
            .stop()
            .then((e) => {
              console.log("clicked");
              rdr.innerHTML = "";
            })
            .catch((e) => console.log("clicked E"));
          run = false;
        }
      }
      docReady(function async() {
        Html5Qrcode.getCameras()
          .then((devices) => {
            /**
             * devices would be an array of objects of type:
             * { id: "id", label: "label" }
             */
            console.log("devices ", devices);
            if (devices && devices.length) {
              if (devices.length == 1) cameraId = devices[0].id;
              if (devices.length == 2) cameraId = devices[1].id;
              console.log("this", cameraId);
              // var resultContainer = document.getElementById("qr-reader-results");
              // resultContainer.innerText = devices.length;
              // .. use this to start scanning.

              let config = {
                fps: 10,
                qrbox: 250,
              };
              console.log("camera id", cameraId);
              html5QrcodeScanner
                .start(cameraId, config, onScanSuccess, () =>
                  console.log("Error occured in scanning")
                )
                .catch((e) => console.log("Promise error"));
            }
          })
          .catch((err) => {
            // handle err
          });
        console.log("this", cameraId);

        var lastResult,
          countResults = 0;
      });
    </script>
  </head>
</html>
